RewriteEngine On

#### DISABLE SITE ####
#Deny from all


#### HTTPS ALWAYS ###
# Redirect everything from HTTP to HTTPS
<IfModule mod_ssl.c>
  RewriteCond %{HTTPS} !=on
  RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]
</IfModule>

# Redirect www to non-www
RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# Hide the .git folder if present (shouldn't)
RewriteRule ^.*\.git.* - [R=404,L]


#### CONTENT TYPE ####

# All resources have a UTF-8 charset as default
AddDefaultCharset UTF-8

# Add content type 'text/plain' for *.asc files (gpg pubkey + ssh pubkey)
AddType 'text/plain' .asc
AddType 'image/webp' .webp
AddType 'image/x-icon' .ico
AddType 'application/xml' .xml
AddType 'application/x-apple-aspen-config' .mobileconfig

#### COMPRESSION ####
SetOutputFilter DEFLATE
AddOutputFilterByType DEFLATE image/*
AddOutputFilterByType DEFLATE text/*
AddOutputFilterByType DEFLATE font/*


#### CACHING ####
ExpiresActive On
#ExpiresDefault “access plus 1 year”
#ExpiresByType */* “access plus 1 year” ExpiresByType image/* "access plus 1 year" ExpiresByType text/* "access plus 1 year"
ExpiresByType font/* "access plus 1 year"
ExpiresByType text/html "access plus 0 seconds"
ExpiresByType application/xml "access plus 0 seconds"
ExpiresByType application/json "access plus 0 seconds"

Header unset ETag
FileETag None


#### SECURE HEADERS ####
# See: https://securityheaders.com

# Set HSTS header (see: hstspreload.org)
Header set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" env=HTTPS

Header set Cross-Origin-Embedder-Policy "require-corp"
Header set Cross-Origin-Opener-Policy "same-origin"
Header set Cross-Origin-Resource-Policy "same-origin"

# Referrer-Policy
Header set Referrer-Policy "no-referrer, never"

# Permission-Policy
Header set Permissions-Policy "interest-cohort=(),geolocation=(),midi=(),notifications=(),push=(),sync-xhr=(),microphone=(),camera=(),magnetometer=(),gyroscope=(),speaker=(),vibrate=(),fullscreen=(),payment=()"

# X-Content-Type-Options
Header set X-Content-Type-Options "nosniff"

# X-XSS-Protection
Header set X-XSS-Protection "1; mode=block"

# X-Frame-Options
Header set X-Frame-Options "deny"

# Remove PHP X-Powered-By header to hide the PHP version from clients
Header unset X-Powered-By

# Remove the server header to hide the server version information
ServerSignature Off
Header unset Server

#### ENFORCE SECURE COOKIES ####
Header always edit Set-Cookie (.*) "$1; HTTPOnly=true, Secure=true, SameSite=Strict"

# 404 page
ErrorDocument 404 /404.html